module.exports = app=>{
    const express = require('express')
    const router =  express.Router()
    const Article = require('../../models/Article')
    const User = require('../../models/User')
    router.get('/article/init',async(req,res)=>{
        await Article.deleteMany({})
        const data = [{"title":"专题 | 朋友，在准备大厂面试吗，内部技术了解一下","visits":582,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"全面分析总结JS内存模型","visits":265,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"VUE 3.0 学习探索入门系列 - 用几个 demo 认识 vue3（3）","visits":937,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"可能是最好的 BFC 解析了... ...","visits":287,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"前端面试之道","visits":854,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"使用vue实现HTML页面生成图片","visits":762,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"这样谈gc，面试官将被你吊打","visits":663,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"【沸点福利】07期：图灵教育来给掘友们送福利啦！","visits":657,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"电商sku组合查询状态细究与实现","visits":961,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"Service Worker简易教程","visits":933,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"吃透 Vue 项目开发实践｜16个方面深入前端工程化开发技巧《下》","visits":964,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"五分钟新概念之宏任务与微任务","visits":12,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"简单通俗的理解Vue3.0中的Proxy","visits":295,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"CSS中容易被忽视的 position属性sticky","visits":201,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"JS小案例——获取随机验证码","visits":424,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"学习 koa 源码的整体架构，浅析koa洋葱模型原理和co原理","visits":395,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"4W字长文带你深度解锁Webpack系列(进阶篇)","visits":188,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"大厂面试题分享：如何让(a===1&&a===2&&a===3)的值为true?","visits":472,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"2020 年，Vue 受欢迎程度是否会超过 React？","visits":572,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"JavaScript实现图片合成下载","visits":592,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"手把手体验http-server服务理解强缓存和协商缓存","visits":639,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"你真的掌握了 JavaScript 变量和类型嘛？（下）","visits":155,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"「面试题」20+Vue面试题整理🔥(持续更新)","visits":891,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"妙用CSS变量，让你的CSS变得更心动","visits":59,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"想前进的前端进行的自我反省","visits":795,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"神策埋点思路","visits":700,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"前端技术百问","visits":903,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"webpack优化实践(遇到很奇葩的问题)","visits":836,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"记好这 24 个 ES6 方法，用来解决实际开发的 JS 问题","visits":22,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"RSA初探，聊聊怎么破解HTTPS","visits":526,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"面试官问：Node 与底层之间如何执行异步 I/O 调用","visits":402,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"💗前端需要了解的计算机网络知识， 这一篇就够了！(图文并茂，万字长文，点赞收藏哦！)","visits":328,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"🔥🔥 用vue全家桶实现mac版微信（不断更新...）","visits":102,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"Ant Design核心作者谈4.0版本更新背后的故事","visits":488,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"关于 vertical-align 你应该知道的一切","visits":207,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"朋友，在准备大厂面试吗，内部技术了解一下","visits":658,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"4W字长文带你深度解锁Webpack系列(基础篇)","visits":841,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"127个常用的JS代码片段，每段代码花30秒就能看懂（四）","visits":891,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"从零到一教你基于vue开发一个组件库","visits":871,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"最新·前端的工资分布情况 - 你拖后腿了吗？","visits":242,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"二月前端实战面试","visits":305,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"60行代码，造一个动画库轮子（超详细）","visits":208,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"vue的源码解析 小白的进阶之路","visits":393,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"JavaScript 中的内存管理是如何工作的","visits":527,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"node.js BFF开发8个月的心路历程","visits":407,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"【建议👍】再来40道this面试题酸爽继续(1.2w字用手整理)","visits":200,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"未来魔法校的微前端实践","visits":634,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"从手写Promise到async/await(接近6千字,建议看一下)","visits":474,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"推荐一个基于Vue 的 H5 快速开发模板","visits":651,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"前端常见的加密算法介绍","visits":860,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"javascript关键的十大优化知识点【建议大忙人的你看看】","visits":510,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"装饰器(Decorator)","visits":720,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"面试题：说说事件循环机制(满分答案来了)","visits":71,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"【建议星星】要就来45道Promise面试题一次爽到底(1.1w字用心整理)","visits":362,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"React Hooks完全上手指南","visits":547,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"从原理谈闭包简单易懂，不看别后悔！","visits":114,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"Fuchsia 的开发语言政策与解读","visits":760,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"React之CLODOP实战：(一)手写并打印快递单","visits":755,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"前端劝退预警：JavaScript 工具链不完全指南","visits":155,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"[译] 理解 CSS 网格布局：创建一个网格容器","visits":832,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"async原理解析","visits":495,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"【小技巧】巧用CSS属性值正则匹配选择器","visits":333,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"小册上新 | React SSR 服务端渲染原理解析与实践","visits":237,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"滚动导航+吸顶合并方案（含sticky详解）","visits":197,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"JS中数组去重的三种方法","visits":164,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"前端面试常考的手写代码不是背出来的！","visits":519,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"JavaScript异步机制知识整理","visits":414,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"(建议收藏)TCP协议灵魂之问，巩固你的网路底层基础","visits":235,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"原生JavaScript实现无缝轮播效果","visits":556,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"记一次vue-element-admin 的动态路由权限管理和菜单渲染的学习","visits":22,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"用JS原生实现轮播图（一）","visits":231,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"基于vue-admin-template+Koa实现你的小程序后台管理系统","visits":774,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"玩转 webpack，使你的打包速度提升 90%","visits":357,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"（值得收藏）JavaScript工具函数大全","visits":816,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"从零开始做一个图片裁剪组件","visits":443,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"微前端在美团外卖的实践","visits":188,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"开源字体不香吗？五款 GitHub 上的爆红字体任君选","visits":389,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"从零到部署：用 Vue 和 Express 实现迷你全栈电商应用（七）","visits":448,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"字节跳动面试官：请你实现一个大文件上传和断点续传","visits":430,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"🔥(已更新3.1w字)《大前端吊打面试官系列》 之 ES6 精华篇（2020年）","visits":986,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"从前端现状到数据校验史","visits":932,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"学以致用：手把手教你撸一个工具库并打包发布，顺便解决JS小数计算不准问题","visits":671,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"跟着大佬技术胖学vue系列-Hello World与初学vue的v-if，v-show，v-for指令","visits":805,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"总结移动端H5开发常用技巧（干货满满哦！）","visits":267,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"前端工程师的自我修养-关于 Babel 那些事儿","visits":431,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"项目中数组循环的一个优化案例","visits":470,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"'&'和'&&' 往年没考,今年肯定要考","visits":339,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"我与花呗与前端技术","visits":39,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"JS中时间格式化的三种方法","visits":423,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"基于Vuex实现小米商城购物车","visits":665,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"了解Vue3源码这一篇就够了","visits":310,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"如何写出优雅健壮的代码？","visits":189,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"详解ES6中的class","visits":815,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"Fuchsia 是什么？Fuchsia OS 的未来如何？","visits":871,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"前端科普系列（2）：Node.js 换个角度看世界","visits":103,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"JS中URL参数处理的三种方法","visits":850,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"Vue之虚拟DOM(vdom)","visits":636,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"Vue->>Router版本太新，导致重复点击路由控制台报错解决方案","visits":583,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"前端必学必会-多媒体-本地存储-浏览器与服务器的交互-通信功能","visits":16,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"我的 Element-ui 源码学习 --- <el-alert>","visits":502,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"再说深拷贝对象的研坑","visits":183,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"从零开发一套完整的react项目开发环境","visits":723,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"编写高质量JavaScript模块的4个最佳实践","visits":841,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"总结vue知识体系之实用技巧","visits":45,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"本周总结请查收(内附21道前端面试题)","visits":246,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"NutUI2.2震撼发布","visits":439,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"2020 前端面试 | 第一波面试题总结","visits":137,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"10分钟教你手写8个常用的自定义hooks","visits":132,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"详解canvas实现图片的拖拽、旋转、缩放(更新在Vue中使用的版本)","visits":815,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"一文搞定前端包管理工具","visits":93,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"593集前端视频教程全部免费 抗击疫情 身体力行","visits":134,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"2020年大厂面试指南-网络篇","visits":633,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"什么是时间分片（Time Slicing）？","visits":615,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"从0到1教你搭建前端团队的组件系统（高级进阶必备）","visits":913,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"【JavaScript】（附面试题）一文搞懂面向对象编程","visits":202,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"基于TCP/IP四层模型浅析计算机网络基本知识（自上向下）","visits":587,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"总结Vue组件的通信","visits":603,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"技术开源项目从零到一的心路历程","visits":699,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"是时候体验一下github action的魅力了","visits":533,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"Webpack优化总会让你不得不爱","visits":665,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"2020年了,再不会webpack敲得代码就不香了(近万字实战)","visits":4,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"打通Vue开发前后台业务的任督二脉","visits":33,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"前后端分离全栈项目的开发与部署流程","visits":119,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"(1.8w字)负重前行，前端工程师如何系统练习数据结构和算法？【上】","visits":867,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"🔥 动画：《大前端吊打面试官系列》 之原生 JavaScript 精华篇","visits":371,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"js获取剪切板图片大小变化的问题","visits":586,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"NutUI 3.0 中单元测试的探索和实践","visits":457,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"Nodejs 进阶：解答 Cluster 模块的几个疑问","visits":380,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"面试官: 聊一聊 HOC、Render props、Hooks","visits":908,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"使用vue+node搭建前端异常监控系统","visits":234,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"前端 - 综合成长学习清单","visits":11,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"精读《如何做好 CodeReview》","visits":651,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"看完跳槽少说涨 5 K，前端面试从准备到谈薪完全指南（近万字精华）","visits":600,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"Vue.js开发去哪儿网WebApp","visits":359,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"Android Studio 3.6 发布啦，快来围观","visits":466,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"前端下载文件的5种方法的对比","visits":993,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"使用vue-cli3搭建Vue+TypeScript项目 框架搭建一","visits":644,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"[深入17] HTTP 和 HTTPS","visits":456,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"忍法，scroll 翻滚之术！","visits":101,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"深入vue响应式原理（包含vue3.0）","visits":509,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"深入理解层叠上下文（2）","visits":311,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"重整旗鼓，2019自结前端面试小册【Vue.Js】","visits":761,"author":"5e6b31ec06762b02f74aa7ed","content":"test"},{"title":"放弃 TypeScript 的 7 个非常好的理由","visits":904,"author":"5e6b31ec06762b02f74aa7ed","content":"test"}]
        await Article.insertMany(data)
        res.send("ok")
    })

    /**
     * 模型分页查询
     */
    router.get('/article/page',async(req,res)=>{
        let {current,pageSize,sort} = req.query
        pageSize= Math.min(pageSize,40)
        sort = JSON.parse(sort)
        console.log(sort)
        const total = Math.ceil(await Article.find().count()/pageSize)
        const list = await Article.find()
        .sort(sort).skip(pageSize*(current-1))
        .populate('author').limit(pageSize).lean()

        const data = {list,page:{current,total,pageSize}}
        res.send(data)
    })
    /**
     * 按id删除文档
     */
    router.delete('/article/:id',async(req,res)=>{
        const success = await Article.findByIdAndDelete(req.params.id)
        if(success){
            return res.send({success:true})
        }
        return res.send({success:false})
        
    })
    /**
     * 按id查找文档
     */
    router.get('/article/:id',async(req,res)=>{
        const data = await Article.findById(req.params.id).populate('author')
        res.send(data || "未查找到该项目")
    })
    /**
     * 按id更新文档
     */
    router.put('/article/:id',async(req,res)=>{
        const sucess = await Article.findByIdAndUpdate(req.params.id,req.body)
        const data = await Article.findById(req.params.id).populate('author')
        res.send(data)
    })

    app.use("/admin/api/v1",router)
}